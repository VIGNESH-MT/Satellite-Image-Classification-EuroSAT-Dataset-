{% extends "base.html" %}

{% block title %}Home - EuroSAT Satellite Image Classifier{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="display-4 fw-bold mb-4">
                    <i class="fas fa-satellite"></i> EuroSAT Classifier
                </h1>
                <p class="lead mb-4">
                    Advanced satellite image classification using deep learning models (VGG16 & ResNet50) 
                    with Google Earth Engine integration for comprehensive land usage analysis.
                </p>
                <div class="d-flex gap-3">
                    <span class="badge bg-light text-dark fs-6">
                        <i class="fas fa-brain"></i> Deep Learning
                    </span>
                    <span class="badge bg-light text-dark fs-6">
                        <i class="fas fa-globe"></i> Earth Engine
                    </span>
                    <span class="badge bg-light text-dark fs-6">
                        <i class="fas fa-map"></i> Interactive Maps
                    </span>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="text-center">
                    <i class="fas fa-satellite-dish fa-10x opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Upload Section -->
<section class="py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-upload"></i> Upload Satellite Image
                        </h3>
                    </div>
                    <div class="card-body">
                        <form action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data" id="uploadForm">
                            <!-- Model Selection -->
                            <div class="mb-4">
                                <label for="model" class="form-label fw-bold">
                                    <i class="fas fa-robot"></i> Select Model
                                </label>
                                <select class="form-select" id="model" name="model" required>
                                    {% for model in models %}
                                        <option value="{{ model }}" {% if model == 'vgg16' %}selected{% endif %}>
                                            {{ model.upper() }} 
                                            {% if model == 'vgg16' %}(Recommended for general use){% endif %}
                                            {% if model == 'resnet50' %}(Better for complex patterns){% endif %}
                                        </option>
                                    {% endfor %}
                                </select>
                                <div class="form-text">
                                    Choose between VGG16 (faster, good accuracy) or ResNet50 (slower, higher accuracy)
                                </div>
                            </div>

                            <!-- File Upload Area -->
                            <div class="mb-4">
                                <label for="file" class="form-label fw-bold">
                                    <i class="fas fa-image"></i> Select Image File
                                </label>
                                <div class="upload-area" id="uploadArea">
                                    <input type="file" class="form-control" id="file" name="file" 
                                           accept=".jpg,.jpeg,.png,.tiff,.tif" required style="display: none;">
                                    <div id="uploadContent">
                                        <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                        <h5>Drag & Drop your image here</h5>
                                        <p class="text-muted">or <a href="#" id="browseLink">browse files</a></p>
                                        <small class="text-muted">
                                            Supported formats: JPG, PNG, TIFF (Max: 16MB)
                                        </small>
                                    </div>
                                    <div id="fileInfo" style="display: none;">
                                        <i class="fas fa-file-image fa-2x text-success mb-2"></i>
                                        <p id="fileName" class="mb-1"></p>
                                        <small id="fileSize" class="text-muted"></small>
                                    </div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg" id="submitBtn" disabled>
                                    <i class="fas fa-magic"></i> Classify Image
                                </button>
                            </div>
                        </form>

                        <!-- Progress Bar -->
                        <div class="mt-3" id="progressContainer" style="display: none;">
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: 0%"></div>
                            </div>
                            <small class="text-muted mt-2 d-block">Processing your image...</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Features Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col">
                <h2 class="fw-bold">Classification Categories</h2>
                <p class="text-muted">Our models can identify the following land use types:</p>
            </div>
        </div>
        <div class="row">
            {% for class_name in classes %}
                <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                {% if class_name == 'Forest' %}
                                    <i class="fas fa-tree fa-2x text-success"></i>
                                {% elif class_name == 'AnnualCrop' or class_name == 'PermanentCrop' %}
                                    <i class="fas fa-seedling fa-2x text-warning"></i>
                                {% elif class_name == 'Residential' %}
                                    <i class="fas fa-home fa-2x text-primary"></i>
                                {% elif class_name == 'Industrial' %}
                                    <i class="fas fa-industry fa-2x text-secondary"></i>
                                {% elif class_name == 'Highway' %}
                                    <i class="fas fa-road fa-2x text-dark"></i>
                                {% elif class_name == 'River' or class_name == 'SeaLake' %}
                                    <i class="fas fa-water fa-2x text-info"></i>
                                {% elif class_name == 'Pasture' or class_name == 'HerbaceousVegetation' %}
                                    <i class="fas fa-leaf fa-2x text-success"></i>
                                {% else %}
                                    <i class="fas fa-map fa-2x text-muted"></i>
                                {% endif %}
                            </div>
                            <h6 class="card-title">{{ class_name }}</h6>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- How It Works Section -->
<section class="py-5">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col">
                <h2 class="fw-bold">How It Works</h2>
                <p class="text-muted">Simple steps to classify your satellite images</p>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="text-center">
                    <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
                         style="width: 60px; height: 60px;">
                        <span class="fw-bold fs-4">1</span>
                    </div>
                    <h5>Upload Image</h5>
                    <p class="text-muted">Upload your satellite image in JPG, PNG, or TIFF format</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="text-center">
                    <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
                         style="width: 60px; height: 60px;">
                        <span class="fw-bold fs-4">2</span>
                    </div>
                    <h5>AI Analysis</h5>
                    <p class="text-muted">Our deep learning models analyze the image features</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="text-center">
                    <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
                         style="width: 60px; height: 60px;">
                        <span class="fw-bold fs-4">3</span>
                    </div>
                    <h5>Get Results</h5>
                    <p class="text-muted">View classification results with confidence scores</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="text-center">
                    <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
                         style="width: 60px; height: 60px;">
                        <span class="fw-bold fs-4">4</span>
                    </div>
                    <h5>Explore Maps</h5>
                    <p class="text-muted">View interactive maps with Google Earth Engine data</p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('file');
    const browseLink = document.getElementById('browseLink');
    const uploadContent = document.getElementById('uploadContent');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const submitBtn = document.getElementById('submitBtn');
    const uploadForm = document.getElementById('uploadForm');
    const progressContainer = document.getElementById('progressContainer');

    // Browse link click
    browseLink.addEventListener('click', function(e) {
        e.preventDefault();
        fileInput.click();
    });

    // Upload area click
    uploadArea.addEventListener('click', function() {
        if (!fileInput.files.length) {
            fileInput.click();
        }
    });

    // Drag and drop functionality
    uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            handleFileSelect();
        }
    });

    // File input change
    fileInput.addEventListener('change', handleFileSelect);

    function handleFileSelect() {
        const file = fileInput.files[0];
        if (file) {
            // Validate file type
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/tiff'];
            if (!allowedTypes.includes(file.type)) {
                alert('Please select a valid image file (JPG, PNG, or TIFF)');
                fileInput.value = '';
                return;
            }

            // Validate file size (16MB)
            if (file.size > 16 * 1024 * 1024) {
                alert('File size must be less than 16MB');
                fileInput.value = '';
                return;
            }

            // Show file info
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            uploadContent.style.display = 'none';
            fileInfo.style.display = 'block';
            submitBtn.disabled = false;
        } else {
            // Reset to upload state
            uploadContent.style.display = 'block';
            fileInfo.style.display = 'none';
            submitBtn.disabled = true;
        }
    }

    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // Form submission with progress
    uploadForm.addEventListener('submit', function(e) {
        if (fileInput.files.length > 0) {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            progressContainer.style.display = 'block';
            
            // Simulate progress (since we can't track actual upload progress easily)
            let progress = 0;
            const progressBar = document.querySelector('.progress-bar');
            const interval = setInterval(function() {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                progressBar.style.width = progress + '%';
            }, 200);

            // Clear interval after form submission
            setTimeout(function() {
                clearInterval(interval);
                progressBar.style.width = '100%';
            }, 2000);
        }
    });
});
</script>
{% endblock %}
